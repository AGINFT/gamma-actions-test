name: Spawn New Repository

on:
  workflow_dispatch:
    inputs:
      repo_name:
        description: 'Nombre del nuevo repositorio'
        required: true
        type: string
      description:
        description: 'DescripciÃ³n del repositorio'
        required: false
        default: 'EPÎ©-7 Gamma Repository'
        type: string

jobs:
  create-repository:
    runs-on: ubuntu-latest
    
    steps:
      - name: Create repository via GitHub API
        env:
          GH_TOKEN: ${{ secrets.GAMMA_PAT }}
        run: |
          echo "ðŸœ‚ Creando repositorio: ${{ inputs.repo_name }} ðŸœ‚"
          
          if [ -z "$GH_TOKEN" ]; then
            echo "âš  ERROR: Secret GAMMA_PAT no configurado"
            echo "Configura el secret en: Settings â†’ Secrets â†’ Actions"
            exit 1
          fi
          
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
            -H "Authorization: token $GH_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/user/repos \
            -d "{\"name\":\"${{ inputs.repo_name }}\",\"description\":\"${{ inputs.description }}\",\"auto_init\":true}")
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | sed '$d')
          
          if [ "$HTTP_CODE" != "201" ]; then
            echo "âš  Error HTTP $HTTP_CODE creando repositorio"
            echo "$BODY"
            exit 1
          fi
          
          REPO_URL=$(echo "$BODY" | grep -o '"html_url": "[^"]*' | cut -d'"' -f4)
          echo "âœ“ Repositorio creado: $REPO_URL"
